{
  "entities": {
    "PaymentRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PaymentRequest",
      "type": "object",
      "description": "Represents a single payment request created by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the payment request."
        },
        "userId": {
          "type": [ "string", "null" ],
          "description": "Reference to User. (Relationship: User 1:N PaymentRequest) The ID of the user who created the payment request. Null for anonymous requests."
        },
        "name": {
            "type": "string",
            "description": "The name of the payee."
        },
        "upiId": {
          "type": "string",
          "description": "The UPI ID to which the payment is requested."
        },
        "amount": {
          "type": "number",
          "description": "The amount requested in the payment."
        },
         "notes": {
            "type": "string",
            "description": "Optional notes for the payment."
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp when the payment request was created.",
          "format": "date-time"
        },
        "expiry": {
            "type": ["string", "null"],
            "description": "The timestamp when the payment link expires.",
            "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The current status of the payment request (e.g., pending, completed, failed)."
        },
        "upiLink": {
          "type": "string",
          "description": "The generated UPI deep link for the payment request."
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "upiId",
        "amount",
        "timestamp",
        "status",
        "upiLink"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the UPI Linker application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "The display name of the user."
        }
      },
      "required": [
        "id",
        "email",
        "displayName"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Access is restricted to authenticated users.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, corresponding to Firebase Authentication's UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/paymentRequests/{paymentRequestId}",
        "definition": {
          "entityName": "PaymentRequest",
          "schema": {
            "$ref": "#/backend/entities/PaymentRequest"
          },
          "description": "Stores payment requests created by a specific user. Access is controlled via path-based ownership; only the user can manage their own payment requests.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who created the payment request."
            },
            {
              "name": "paymentRequestId",
              "description": "The unique identifier of the payment request."
            }
          ]
        }
      },
       {
        "path": "/publicPaymentRequests/{paymentRequestId}",
        "definition": {
          "entityName": "PaymentRequest",
          "schema": {
            "$ref": "#/backend/entities/PaymentRequest"
          },
          "description": "Stores payment requests created anonymously. These are publicly readable but cannot be listed or modified after creation.",
          "params": [
             {
              "name": "paymentRequestId",
              "description": "The unique identifier of the payment request."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed for a public-first UPI payment link generator. It supports both anonymous and authenticated users. Authenticated users' payment requests are stored in a subcollection under their user document (`/users/{userId}/paymentRequests/{paymentRequestId}`), ensuring strong data ownership and simplifying security rules. Anonymous requests are stored in a top-level collection (`/publicPaymentRequests/{paymentRequestId}`), which allows for public read access to individual documents but prevents listing the entire collection, protecting user privacy. This separation ensures scalability and security, allowing for features like link history and management for registered users while providing a quick and easy experience for anonymous users."
  }
}
